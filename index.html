<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NMR Chemical Shift Database Viewer</title>
  <style>
    /* same styles as before... shortened for space */
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .compound-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(350px,1fr)); gap:1.5rem; margin-top:2rem; }
    .compound-card { background:#fff; border-radius:10px; padding:1.5rem; box-shadow:0 2px 10px rgba(0,0,0,0.1); cursor:pointer; }
    .compound-card:hover { transform:translateY(-5px); box-shadow:0 5px 20px rgba(0,0,0,0.2); }
    .pagination { display:flex; justify-content:center; gap:0.5rem; margin:2rem 0; }
    .pagination button { padding:0.5rem 1rem; border:none; border-radius:5px; background:#667eea; color:#fff; cursor:pointer; }
    .pagination button:disabled { background:#ccc; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>NMR Chemical Shift Database</h1>
      <p class="subtitle">Browse and search 57,000+ chemical compounds with NMR data</p>
    </header>

    <div class="search-section">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search by InChI key, SMILES, or NMR ID...">
        <button onclick="searchCompounds()">Search</button>
        <button onclick="loadRandomCompounds()">Browse Random</button>
      </div>
    </div>

    <div class="stats">
      <div class="stat-card"><div class="stat-number" id="totalCompounds">57,055</div><div>Total Compounds</div></div>
      <div class="stat-card"><div class="stat-number" id="loadedCompounds">0</div><div>Loaded</div></div>
      <div class="stat-card"><div class="stat-number" id="with1H">0</div><div>With ¹H NMR</div></div>
      <div class="stat-card"><div class="stat-number" id="with13C">0</div><div>With ¹³C NMR</div></div>
    </div>

    <div id="loading" class="loading" style="display:none;">Loading compounds...</div>
    <div id="error" class="error" style="display:none;"></div>

    <div id="compounds" class="compound-grid"></div>
    <div class="pagination" id="pagination"></div>
  </div>

  <!-- Modal -->
  <div id="compoundModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle">Compound Details</h2>
      <div id="modalContent"></div>
    </div>
  </div>

<script>
  const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/pb-commits/nmrshift2db/main/';
  const PAGE_SIZE = 30;
  let currentCompounds = [];
  let currentPage = 1;

  const sampleInchiKeys = [
    'AAAISYODTULZTR-DARAHFNDSA-N','AAAQKTZKLRYKHR-UHFFFAOYSA-N','AAARTTJTRNAYHQ-NXEZZACHSA-N',
    'AAARTTJTRNAYHQ-VHSXEESVSA-N','AAASFPHGEWHGIB-UHFFFAOYSA-N','AAAXMNYUNVCMCJ-UHFFFAOYSA-N',
    'AABOCLLAUKSOSG-RKDXNWHRSA-N','QGMWDUUHVVLHNP-JQXSQYPDSA-N','GJNXTRPTZOVADS-PWRGDLIESA-N',
    'UNPSXBKCCZEIRN-UHFFFAOYSA-N'
  ];

  async function loadCompound(inchiKey) {
    try {
      const res = await fetch(`${GITHUB_RAW_BASE}${inchiKey}.json`);
      if (!res.ok) throw new Error(res.status);
      return await res.json();
    } catch { return null; }
  }

  async function loadRandomCompounds() {
    showLoading(true); hideError();
    const keysToLoad = [...sampleInchiKeys].sort(()=>0.5-Math.random()).slice(0, PAGE_SIZE);
    const compounds = [];
    for (const key of keysToLoad) {
      const data = await loadCompound(key);
      if (data) compounds.push({inchiKey:key, data});
    }
    currentCompounds = compounds;
    currentPage = 1;
    renderPage();
    updateStats(compounds);
    showLoading(false);
  }

  async function searchCompounds() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) return loadRandomCompounds();

    showLoading(true); hideError();
    const compounds = [];
    for (const key of sampleInchiKeys) {
      const data = await loadCompound(key);
      if (data) {
        const s = query.toLowerCase();
        if (key.toLowerCase().includes(s) || (data.SMILES||'').toLowerCase().includes(s)) {
          compounds.push({inchiKey:key, data});
        }
      }
    }
    if (!compounds.length) showError(`No compounds found matching "${query}"`);
    currentCompounds = compounds;
    currentPage = 1;
    renderPage();
    updateStats(compounds);
    showLoading(false);
  }

  function renderPage() {
    const start = (currentPage-1)*PAGE_SIZE;
    const end = start+PAGE_SIZE;
    const pageCompounds = currentCompounds.slice(start,end);
    displayCompounds(pageCompounds);
    renderPagination();
  }

  function displayCompounds(compounds) {
    const container = document.getElementById('compounds');
    if (!compounds.length) { container.innerHTML='<p>No compounds.</p>'; return; }
    container.innerHTML = compounds.map(c=>{
      const d=c.data;
      return `<div class="compound-card" onclick="showCompoundDetails('${c.inchiKey}')">
        <div class="compound-id">${c.inchiKey}</div>
        <div class="compound-smiles">${d.SMILES||'No SMILES'}</div>
      </div>`;
    }).join('');
  }

  function renderPagination() {
    const totalPages = Math.ceil(currentCompounds.length/PAGE_SIZE)||1;
    const p=document.getElementById('pagination');
    if(totalPages<=1){ p.innerHTML=''; return;}
    p.innerHTML=`
      <button onclick="changePage(${currentPage-1})" ${currentPage===1?'disabled':''}>Prev</button>
      <span>Page ${currentPage} of ${totalPages}</span>
      <button onclick="changePage(${currentPage+1})" ${currentPage===totalPages?'disabled':''}>Next</button>
    `;
  }
  function changePage(n){ currentPage=n; renderPage(); }

  function updateStats(compounds) {
    document.getElementById('loadedCompounds').textContent=compounds.length;
    let with1H=0, with13C=0;
    compounds.forEach(c=>{
      const k=Object.keys(c.data);
      if(k.some(x=>x.includes('Spectrum 1H'))) with1H++;
      if(k.some(x=>x.includes('Spectrum 13C'))) with13C++;
    });
    document.getElementById('with1H').textContent=with1H;
    document.getElementById('with13C').textContent=with13C;
  }

  function showCompoundDetails(inchiKey) {
    const c=currentCompounds.find(x=>x.inchiKey===inchiKey); if(!c) return;
    document.getElementById('modalTitle').textContent=`Compound: ${inchiKey}`;
    document.getElementById('modalContent').innerHTML=`<pre>${JSON.stringify(c.data,null,2)}</pre>`;
    document.getElementById('compoundModal').style.display='block';
  }
  function closeModal(){ document.getElementById('compoundModal').style.display='none'; }

  function showLoading(b){document.getElementById('loading').style.display=b?'block':'none';}
  function showError(m){const e=document.getElementById('error'); e.textContent=m; e.style.display='block';}
  function hideError(){document.getElementById('error').style.display='none';}

  window.onclick = e => { if(e.target===document.getElementById('compoundModal')) closeModal(); }
  document.getElementById('searchInput').addEventListener('keypress', e=>{ if(e.key==='Enter') searchCompounds(); });
  loadRandomCompounds();
</script>
</body>
</html>