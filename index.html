<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMR Chemical Shift Database Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #888;
            --border-color: #e9ecef;
            --shadow: rgba(0,0,0,0.1);
            --shadow-hover: rgba(0,0,0,0.15);
            --accent: #667eea;
            --accent-hover: #5a6fd8;
            --disabled-bg: #f8f9fa;
            --disabled-text: #adb5bd;
            --disabled-border: #e9ecef;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #999999;
            --border-color: #404040;
            --shadow: rgba(0,0,0,0.3);
            --shadow-hover: rgba(0,0,0,0.4);
            --accent: #7c3aed;
            --accent-hover: #6d28d9;
            --disabled-bg: #1a1a1a;
            --disabled-text: #666666;
            --disabled-border: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 10px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            margin-bottom: 2rem;
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .filter-group select {
            padding: 0.5rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .filter-group select:hover:not(:disabled) {
            border-color: var(--accent);
        }

        .filter-group select option {
            padding: 0.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .filter-group select option:disabled {
            background: var(--disabled-bg);
            color: var(--disabled-text);
            font-style: italic;
        }

        /* Disabled filter styling */
        .filter-group select:disabled {
            background: var(--disabled-bg);
            color: var(--disabled-text);
            border-color: var(--disabled-border);
            cursor: not-allowed;
        }

        .filter-group.disabled label {
            color: var(--disabled-text);
        }

        input[type="text"] {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        button {
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        button:hover {
            background: var(--accent-hover);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .compound-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .compound-card {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .compound-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px var(--shadow-hover);
        }

        .compound-id {
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .compound-smiles {
            font-family: monospace;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            word-break: break-all;
        }

        .compound-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .info-label {
            font-weight: bold;
            color: var(--text-secondary);
        }

        .nmr-badges {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nmr-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .nmr-badge.available {
            background: #d4edda;
            color: #155724;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--bg-secondary);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .json-viewer {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-primary);
            box-shadow: 0 2px 10px var(--shadow);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow-hover);
        }

        .theme-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(20deg);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
            
            .compound-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <span class="theme-icon">🌙</span>
        <span class="theme-text">Dark</span>
    </div>
    
    <div class="container">
        <header>
            <h1>NMR Chemical Shift Database</h1>
            <p class="subtitle">Browse and search 57,000+ chemical compounds with NMR data</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search by InChI key, SMILES, or NMR ID...">
                <button onclick="searchCompounds()">Search</button>
                <button onclick="loadFilteredCompounds()">Apply Filter</button>
            </div>
            
            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group" id="nmrFilterGroup">
                        <label for="nmrFilter">NMR Type:</label>
                        <select id="nmrFilter" onchange="updateFilterAvailability()">
                            <option value="">All NMR Types</option>
                            <option value="1H">¹H NMR (604 spectra)</option>
                            <option value="13C">¹³C NMR (1516 spectra)</option>
                            <option value="31P">³¹P NMR (475 spectra)</option>
                            <option value="19F">¹⁹F NMR (24 spectra)</option>
                            <option value="15N">¹⁵N NMR (3 spectra)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group" id="solventFilterGroup">
                        <label for="solventFilter">Solvent:</label>
                        <select id="solventFilter" onchange="updateFilterAvailability()">
                            <option value="">All Solvents</option>
                            <option value="Chloroform-D1 (CDCl3)">CDCl₃ (192 compounds)</option>
                            <option value="Dimethylsulphoxide-D6 (DMSO-D6, C2D6SO)">DMSO-d₆ (27 compounds)</option>
                            <option value="Methanol-D4 (CD3OD)">CD₃OD (20 compounds)</option>
                            <option value="Unknown">Unknown Solvent</option>
                            <option value="Unreported">Unreported Solvent</option>
                        </select>
                    </div>
                    
                    <div class="filter-group" id="fieldFilterGroup">
                        <label for="fieldFilter">Field Strength:</label>
                        <select id="fieldFilter" onchange="updateFilterAvailability()">
                            <option value="">All Field Strengths</option>
                            <option value="100">100 MHz (84 compounds)</option>
                            <option value="141">141 MHz (68 compounds)</option>
                            <option value="125">125 MHz (64 compounds)</option>
                            <option value="75">75 MHz (52 compounds)</option>
                            <option value="400">400 MHz (36 compounds)</option>
                            <option value="500">500 MHz (35 compounds)</option>
                            <option value="300">300 MHz (34 compounds)</option>
                            <option value="150">150 MHz (33 compounds)</option>
                            <option value="600">600 MHz (28 compounds)</option>
                            <option value="700">700 MHz (16 compounds)</option>
                            <option value="Unknown">Unknown Field Strength</option>
                            <option value="Unreported">Unreported Field Strength</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="limitFilter">Show:</label>
                        <select id="limitFilter">
                            <option value="5">5 compounds</option>
                            <option value="10">10 compounds</option>
                            <option value="15">15 compounds</option>
                            <option value="20">20 compounds</option>
                            <option value="25">25 compounds</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 1rem;">
                💡 Filters automatically update to show only available combinations. Grayed out options are not available with current selections.
            </p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalCompounds">56,938</div>
                <div>Total Compounds</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="loadedCompounds">0</div>
                <div>Loaded Compounds</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">5</div>
                <div>NMR Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div>Main Solvents</div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <p>Loading compounds...</p>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="compoundGrid" class="compound-grid"></div>
    </div>

    <div id="compoundModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Compound Details</h2>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Configuration
        const LOCAL_FILES = true;
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/pb-commits/nmrshift2db/main/';
        
        let allCompounds = [];
        let filteredCompounds = [];
        let currentPage = 0;
        let availableFiles = [];

        // Filter combinations based on actual data analysis
        const filterCombinations = {
            '1H': {
                solvents: ['Chloroform-D1 (CDCl3)', 'Dimethylsulphoxide-D6 (DMSO-D6, C2D6SO)', 'Methanol-D4 (CD3OD)', 'Unknown', 'Unreported'],
                fields: ['100', '141', '125', '75', '400', '500', '300', '150', '600', '700', 'Unknown', 'Unreported']
            },
            '13C': {
                solvents: ['Chloroform-D1 (CDCl3)', 'Dimethylsulphoxide-D6 (DMSO-D6, C2D6SO)', 'Methanol-D4 (CD3OD)', 'Unknown', 'Unreported'],
                fields: ['100', '141', '125', '75', '400', '500', '300', '150', '600', '700', 'Unknown', 'Unreported']
            },
            '31P': {
                solvents: ['Unknown', 'Unreported'],
                fields: ['Unknown', 'Unreported']
            },
            '19F': {
                solvents: ['Chloroform-D1 (CDCl3)', 'Dimethylsulphoxide-D6 (DMSO-D6, C2D6SO)', 'Unknown', 'Unreported'],
                fields: ['Unknown', 'Unreported']
            },
            '15N': {
                solvents: ['Unknown', 'Unreported'],
                fields: ['Unknown', 'Unreported']
            }
        };

        // Theme Management
        function initializeTheme() {
            const savedTheme = localStorage.getItem('nmr-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('nmr-theme', newTheme);
            updateThemeToggle(newTheme);
        }

        function updateThemeToggle(theme) {
            const themeIcon = document.querySelector('.theme-icon');
            const themeText = document.querySelector('.theme-text');
            
            if (theme === 'dark') {
                themeIcon.textContent = '☀️';
                themeText.textContent = 'Light';
            } else {
                themeIcon.textContent = '🌙';
                themeText.textContent = 'Dark';
            }
        }

        // Filter availability management
        function updateFilterAvailability() {
            const nmrFilter = document.getElementById('nmrFilter');
            const solventFilter = document.getElementById('solventFilter');
            const fieldFilter = document.getElementById('fieldFilter');
            
            const selectedNMR = nmrFilter.value;
            const selectedSolvent = solventFilter.value;
            
            // Reset all options to enabled
            enableAllFilterOptions();
            
            if (selectedNMR) {
                // Disable unavailable solvents for selected NMR type
                const availableSolvents = filterCombinations[selectedNMR].solvents;
                disableUnavailableOptions(solventFilter, availableSolvents);
                
                // If a solvent is selected, also filter fields
                if (selectedSolvent && availableSolvents.includes(selectedSolvent)) {
                    const availableFields = filterCombinations[selectedNMR].fields;
                    disableUnavailableOptions(fieldFilter, availableFields);
                }
            }
            
            // If only solvent is selected (no NMR), show all fields
            if (!selectedNMR && selectedSolvent) {
                // Keep all field options available
            }
        }

        function enableAllFilterOptions() {
            const filters = ['solventFilter', 'fieldFilter'];
            
            filters.forEach(filterId => {
                const select = document.getElementById(filterId);
                const group = document.getElementById(filterId + 'Group');
                
                // Enable all options
                Array.from(select.options).forEach(option => {
                    option.disabled = false;
                    option.style.color = '';
                    option.style.fontStyle = '';
                });
                
                // Enable the select element and group
                select.disabled = false;
                group.classList.remove('disabled');
            });
        }

        function disableUnavailableOptions(selectElement, availableValues) {
            Array.from(selectElement.options).forEach(option => {
                if (option.value === '') {
                    // Always keep the "All" option available
                    option.disabled = false;
                    option.style.color = '';
                    option.style.fontStyle = '';
                } else if (!availableValues.includes(option.value)) {
                    // Disable unavailable options
                    option.disabled = true;
                    option.style.color = 'var(--disabled-text)';
                    option.style.fontStyle = 'italic';
                } else {
                    // Keep available options enabled
                    option.disabled = false;
                    option.style.color = '';
                    option.style.fontStyle = '';
                }
            });
        }

        // Initialize available files list
        async function initializeAvailableFiles() {
            const sampleFiles = [
                'AAAISYODTULZTR-DARAHFNDSA-N.json',
                'AAAQKTZKLRYKHR-UHFFFAOYSA-N.json',
                'AAARTTJTRNAYHQ-NXEZZACHSA-N.json',
                'AAARTTJTRNAYHQ-VHSXEESVSA-N.json',
                'AAASFPHGEWHGIB-UHFFFAOYSA-N.json',
                'AAAXMNYUNVCMCJ-UHFFFAOYSA-N.json',
                'AABOCLLAUKSOSG-RKDXNWHRSA-N.json',
                'QGMWDUUHVVLHNP-JQXSQYPDSA-N.json',
                'GJNXTRPTZOVADS-PWRGDLIESA-N.json',
                'UNPSXBKCCZEIRN-UHFFFAOYSA-N.json',
                'ZEKAXIFHLIITGV-UHFFFAOYSA-N.json',
                'WUADCCWRTIWKIC-UHFFFAOYSA-N.json',
                'VHRGRCVQAFMJIZ-UHFFFAOYSA-N.json',
                'UFSCUCAEUNYCKX-UHFFFAOYSA-N.json',
                'TZERFULGIUVIGO-UHFFFAOYSA-N.json',
                'SXJWSJQUNMFOSK-UHFFFAOYSA-N.json',
                'RWSOTUBLDIXVET-UHFFFAOYSA-N.json',
                'QZRVSLHMLPKULR-UHFFFAOYSA-N.json',
                'PKZCNXHKXOPNOV-UHFFFAOYSA-N.json',
                'OJWKTCDVKWGWDY-UHFFFAOYSA-N.json',
                'NIXOWILDQLNWCW-UHFFFAOYSA-N.json',
                'MWHVXIOWNAJDQZ-UHFFFAOYSA-N.json',
                'LWHOVWRFCVHHJQ-UHFFFAOYSA-N.json',
                'KVWJXWZOKYOFNK-UHFFFAOYSA-N.json',
                'JZXXOCUPIKVFOY-UHFFFAOYSA-N.json'
            ];
            availableFiles = sampleFiles;
        }

        async function loadCompound(filename) {
            try {
                let url;
                if (LOCAL_FILES) {
                    url = filename;
                } else {
                    url = `${GITHUB_RAW_BASE}${filename}`;
                }
                
                const response = await fetch(url);
                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error(`Error loading ${filename}:`, error);
                return null;
            }
        }

        async function loadFilteredCompounds() {
            showLoading(true);
            hideError();
            
            const nmrFilter = document.getElementById('nmrFilter').value;
            const solventFilter = document.getElementById('solventFilter').value;
            const fieldFilter = document.getElementById('fieldFilter').value;
            const limitFilter = parseInt(document.getElementById('limitFilter').value);
            
            const compounds = [];
            let loaded = 0;
            const maxLoad = Math.min(limitFilter, availableFiles.length);
            
            for (const filename of availableFiles) {
                if (loaded >= maxLoad) break;
                
                const data = await loadCompound(filename);
                if (data) {
                    // Apply filters
                    let passesFilter = true;
                    
                    if (nmrFilter && !hasNMRType(data, nmrFilter)) {
                        passesFilter = false;
                    }
                    
                    if (solventFilter && !hasSolvent(data, solventFilter)) {
                        passesFilter = false;
                    }
                    
                    if (fieldFilter && !hasFieldStrength(data, fieldFilter)) {
                        passesFilter = false;
                    }
                    
                    if (passesFilter) {
                        const inchiKey = filename.replace('.json', '');
                        compounds.push({
                            inchiKey: inchiKey,
                            data: data,
                            filename: filename
                        });
                        loaded++;
                    }
                }
            }
            
            allCompounds = compounds;
            displayCompounds(compounds);
            updateStats();
            showLoading(false);
            
            if (compounds.length === 0) {
                showError('No compounds found matching the selected filters. Try adjusting your criteria or check if the files are available.');
            }
        }

        function hasNMRType(data, nmrType) {
            // Check for spectrum data with the specific NMR type
            for (const key in data) {
                if (key.includes('Spectrum') && key.includes(nmrType)) {
                    const spectrum = data[key];
                    if (spectrum && spectrum.trim() && spectrum !== '0:Unreported ') {
                        return true;
                    }
                }
            }
            return false;
        }

        function hasSolvent(data, solvent) {
            const solventValue = data['Solvent'] || '';
            if (!solventValue || solventValue === '0:Unreported ') {
                return solvent === 'Unreported';
            }
            if (solventValue === '0:Unknown ') {
                return solvent === 'Unknown';
            }
            return solventValue.includes(solvent);
        }

        function hasFieldStrength(data, field) {
            const fieldValue = data['Field Strength [MHz]'] || '';
            if (!fieldValue || fieldValue === '0:Unreported ') {
                return field === 'Unreported';
            }
            if (fieldValue === '0:Unknown ') {
                return field === 'Unknown';
            }
            return fieldValue.includes(field);
        }

        async function searchCompounds() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                loadFilteredCompounds();
                return;
            }

            showLoading(true);
            hideError();

            const compounds = [];
            
            // Search in available files
            for (const filename of availableFiles) {
                const data = await loadCompound(filename);
                if (data) {
                    const searchLower = query.toLowerCase();
                    const inchiKey = filename.replace('.json', '');
                    
                    if (inchiKey.toLowerCase().includes(searchLower) ||
                        (data.SMILES && data.SMILES.toLowerCase().includes(searchLower)) ||
                        (data['nmrshiftdb2 ID'] && data['nmrshiftdb2 ID'].toString().includes(query))) {
                        compounds.push({
                            inchiKey: inchiKey,
                            data: data,
                            filename: filename
                        });
                    }
                }
            }

            allCompounds = compounds;
            displayCompounds(compounds);
            updateStats();
            showLoading(false);
            
            if (compounds.length === 0) {
                showError('No compounds found matching your search. Try a different search term.');
            }
        }

        function displayCompounds(compounds) {
            const grid = document.getElementById('compoundGrid');
            grid.innerHTML = '';

            compounds.forEach(compound => {
                const card = createCompoundCard(compound);
                grid.appendChild(card);
            });
        }

        function createCompoundCard(compound) {
            const card = document.createElement('div');
            card.className = 'compound-card';
            card.onclick = () => showCompoundDetails(compound);

            const data = compound.data;
            const nmrTypes = getNMRTypes(data);
            
            card.innerHTML = `
                <div class="compound-id">${compound.inchiKey}</div>
                <div class="compound-smiles">${data.SMILES || 'No SMILES available'}</div>
                <div class="compound-info">
                    <div><span class="info-label">ID:</span> ${data['nmrshiftdb2 ID'] || 'N/A'}</div>
                    <div><span class="info-label">Solvent:</span> ${formatSolvent(data['Solvent']) || 'N/A'}</div>
                    <div><span class="info-label">Temperature:</span> ${formatTemperature(data['Temperature [K]']) || 'N/A'}</div>
                    <div><span class="info-label">Field:</span> ${formatField(data['Field Strength [MHz]']) || 'N/A'}</div>
                </div>
                <div class="nmr-badges">
                    ${nmrTypes.map(type => `<span class="nmr-badge available">${type}</span>`).join('')}
                </div>
            `;

            return card;
        }

        function getNMRTypes(data) {
            const types = [];
            
            for (const key in data) {
                if (key.includes('Spectrum')) {
                    if (key.includes('1H')) types.push('¹H');
                    else if (key.includes('13C')) types.push('¹³C');
                    else if (key.includes('31P')) types.push('³¹P');
                    else if (key.includes('19F')) types.push('¹⁹F');
                    else if (key.includes('15N')) types.push('¹⁵N');
                    else if (key.includes('11B')) types.push('¹¹B');
                }
            }
            
            return [...new Set(types)]; // Remove duplicates
        }

        function formatSolvent(solvent) {
            if (!solvent || solvent === '0:Unreported ') return null;
            if (solvent === '0:Unknown ') return 'Unknown';
            
            // Extract the actual solvent name
            const match = solvent.match(/([A-Za-z0-9\-\(\)]+)/);
            return match ? match[1] : solvent;
        }

        function formatTemperature(temp) {
            if (!temp || temp === '0:Unreported ') return null;
            if (temp === '0:Unknown ') return 'Unknown';
            
            // Extract numeric value
            const match = temp.match(/(\d+)/);
            return match ? match[1] + ' K' : temp;
        }

        function formatField(field) {
            if (!field || field === '0:Unreported ') return null;
            if (field === '0:Unknown ') return 'Unknown';
            
            // Extract numeric value
            const match = field.match(/(\d+)/);
            return match ? match[1] + ' MHz' : field;
        }

        function showCompoundDetails(compound) {
            const modal = document.getElementById('compoundModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `Compound: ${compound.inchiKey}`;
            content.innerHTML = `
                <div class="json-viewer">${JSON.stringify(compound.data, null, 2)}</div>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('compoundModal').style.display = 'none';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function updateStats() {
            document.getElementById('loadedCompounds').textContent = allCompounds.length;
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchCompounds();
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('compoundModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize everything
        async function initialize() {
            initializeTheme();
            await initializeAvailableFiles();
            updateFilterAvailability(); // Initialize filter availability
            loadFilteredCompounds();
        }

        // Start the application
        initialize();
    </script>
</body>
</html>
